# CrmPlatformAPI

This folder contains the backend implementation of the CRM web platform developed as my Bachelor's thesis project at the University of Bucharest, Faculty of Mathematics and Computer Science.

## Project Overview

The purpose of this project was to build a scalable, modern CRM application that facilitates collaboration between software providers and client companies via a robust support ticketing system and integrated AI features. The backend is implemented using ASP.NET Core Web API with a clean architecture that separates responsibilities and allows for easy maintenance and testing.

---

## Technologies Used

- ASP.NET Core Web API
- Entity Framework Core (Code-First, SQL Server on Azure)
- ASP.NET Core Identity with JWT authentication
- AutoMapper for object mapping
- SignalR for real-time communication (online presence)
- Cloudinary for media and file storage
- Gmail SMTP for sending email notifications

> AI features (LLM integration, translation, summarization, sentiment analysis) are implemented in a separate Python-based repository. Link to this repository:
**https://github.com/VladRo26/Python-LLM-CrmPlatform**

---

## Development Environment

The backend was developed using Visual Studio with the following setup:

- .NET SDK and Runtime installed
- Workloads: ASP.NET and Web Development, Data Storage and Processing
- SQL Server configured locally and hosted via Azure SQL
- NuGet packages used include:
  - Microsoft.EntityFrameworkCore
  - Microsoft.AspNetCore.Identity
  - Microsoft.AspNetCore.Authentication.JwtBearer
  - AutoMapper.Extensions.Microsoft.DependencyInjection

Configuration is managed through `appsettings.json` and environment-specific overrides.

---

## Architecture Overview

The solution is organized by layers and responsibilities:

- **Models**: Domain entities and Data Transfer Objects (DTOs)
- **Repositories**: Abstract data access logic using interfaces and implementations
- **Controllers**: Expose RESTful API endpoints
- **Services**: Implement core logic such as authentication, file storage, email sending
- **Helpers**: Contain reusable configurations like AutoMapper profiles and Cloudinary settings
- **Extensions**: Startup configuration split into clean extension methods

This separation allows maintainability, testing, and scalability.

---

## Authentication and Authorization

- ASP.NET Core Identity manages users and roles in the database.
- JWT authentication secures all API endpoints.
- Role-based policies (e.g., Admin, Moderator) are applied using authorization attributes.
- User claims include role and identity metadata, used both in API and SignalR communications.

---

## Database Design

- Code-First approach using Entity Framework Core
- Domain models define the relational schema
- Tables include: Users, Roles, Companies, Projects, Tickets, TicketStatusHistory, Attachments, Feedback

An Entity-Relationship Diagram (ERD) was created to visualize and document the database structure. You can view it here:
**<img width="979" height="599" alt="image" src="https://github.com/user-attachments/assets/296c187e-a2ca-4eac-a106-11a761f18f51" />**

---

## DTO Usage and AutoMapper

- DTOs are used for all user input and output to ensure encapsulation and validation.
- AutoMapper is configured centrally to map between entities and DTOs.
- This ensures security (no over-posting), performance, and clarity.

---

## AI Integration (External Microservice)

AI capabilities are handled by a Python FastAPI service hosted separately. The backend communicates with it to:

- Generate ticket summaries based on content
- Translate text to and from English
- Perform sentiment analysis on feedback
- Generate professional feedback messages based on user input and rating

All API calls to the microservice are encapsulated in a dedicated repository (`RepositoryLLM`), injected via dependency injection. The AI service is hosted independently and versioned separately.

> Link to the external AI microservice repository:
**https://github.com/VladRo26/Python-LLM-CrmPlatform** 

---

## Ticket and Feedback System

- Tickets can contain a title, description, attachments, and optional project reference
- A summary and translated version are generated by the AI microservice
- Status changes are tracked in a timeline with optional attachments
- Feedback is stored for each ticket and includes:
  - Star rating
  - Generated suggestion text
  - Sentiment score

---

## File and Media Upload

- Cloudinary is used for all media storage (both images and generic files)
- `PhotoService` handles user avatars and image previews
- `FileService` handles raw uploads like PDFs or ZIPs
- Files are linked to tickets or ticket status updates and served via secure public URLs

---

## Email Notification System

- On ticket status change, the user receives a structured email via Gmail SMTP
- Email includes:
  - Ticket info
  - Status update
  - Download links for attachments
  - Sender metadata and company/project context

All logic is centralized in the `EmailService`.

---

## Real-Time Presence with SignalR

- SignalR is used to manage and track connected users
- Users joining/disconnecting trigger presence updates
- The frontend receives real-time presence info to display online collaborators
- JWT token is passed via the WebSocket connection query string and validated on connection

---

## Deployment

- Backend is deployed on Fly.io (Linux container via Docker)
- SQL Server is hosted via Azure
- AI service is deployed on Render.com (Python FastAPI)
- Media is stored on Cloudinary with API key/secret configured via environment variables

---

## Conclusion

This backend provides the foundational infrastructure for a complete CRM and support system with integrated AI. It is designed with modularity, clarity, and extensibility in mind. Real-time presence, automatic notifications, file handling, secure authentication, and advanced feedback intelligence make it suitable for modern use in software-client collaboration environments.
